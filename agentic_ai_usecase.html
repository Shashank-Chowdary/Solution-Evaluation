<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic AI Suitability - Solution</title>

    <!-- PDF.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>

<!-- Mammoth.js for DOCX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #b6d6f0 0%, #f1def1 100%);
            color: #1d1d1f;
            line-height: 1.4;
        }

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 15px;
}

.header {
    text-align: center;
    margin-bottom: 20px;
}

.header h1 {
    font-size: 26px;
    font-weight: 600;
    margin-bottom: 8px;
}

.header p {
    color: #86868b;
    font-size: 13px;
}

        .main-content {
           
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .left-panel {
            background: linear-gradient(135deg, #d9e8f1 50%, #38492f 100%);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            width: 100%;
        }

.right-panel {
    background: rgb(234, 245, 234);
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.1);
    width: 100%;
    margin-top: 10px;
    border: 2px solid #c9bbbb;
    font-style: italic;
}

.section {
    margin-bottom: 20px;
}

.section h3 {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 12px;
    color: #1d1d1f;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 6px;
    color: #424245;
}

        .input-method-tab {
    flex: 1;
    padding: 10px 20px;
    border: 1px solid #d2d2d7;
    border-radius: 6px;
    background: white;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    color: #424245;
}

.input-method-tab:hover {
    background: #f5f5f7;
    border-color: #007aff;
}

.input-method-tab.active {
    background: #b1cfe2;
    color: rgb(19, 11, 11);
    border-color: #007aff;
}

#dropZone:hover {
    border-color: #007aff !important;
    background: #f0f8ff !important;
}

#dropZone.dragging {
    border-color: #007aff !important;
    background: #e3f2ff !important;
}

        .required {
            color: #ff3b30;
        }

input[type="text"], select {
    width: 100%;
    padding: 10px;
    border: 1px solid #d2d2d7;
    border-radius: 8px;
    font-size: 13px;
    background: white;
}

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0,122,255,0.1);
        }

textarea {
    width: 100%;
    min-height: 80px;
    padding: 10px;
    border: 1px solid white;
    border-radius: 8px;
    font-size: 13px;
    resize: vertical;
    font-family: inherit;
}

        textarea:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0,122,255,0.1);
        }

.category-section {
    margin-bottom: 20px;
    border: 2px solid #e5e5ea;
    border-radius: 12px;
    padding: 15px;
    background: #fafafa;
}

.category-title {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 5px;
    color: #1d1d1f;
}

.category-weight {
    font-size: 11px;
    color: #86868b;
    margin-bottom: 12px;
    font-style: italic;
}

        /* .business-value { border-color: #bbc7dd; background: linear-gradient(135deg, #a3c4d8 0%, #c9e2e1 100%); }
        .technical-fit {  background: linear-gradient(135deg, #bdebd2 0%, #a0dbc9 100%)}
        .safety-governance {  background: linear-gradient(135deg, #e3ecba 0%, #c2eed1 100%) } */

        .business-value { border-color: #34c759; }
        .technical-fit { border-color: #007aff; }
        .safety-governance { border-color: #ff9500; }

.risk-factors {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 12px;
}

.factor-group {
    background: rgb(236, 243, 242);
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #e5e5ea;
}

.factor-title {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 4px;
    color: #1d1d1f;
}

.factor-subtitle {
    font-size: 11px;
    color: #86868b;
    margin-bottom: 10px;
    line-height: 1.3;
}

        .risk-buttons {
            display: flex;
            gap: 8px;
        }

        .risk-btn {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            background: white;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .risk-btn:hover {
            background: #ceceeb;
            border-color: #007aff;
            transform: translateY(-1px);
        }

        .risk-btn.active {
            color: white !important;
            border-color: transparent !important;
            transform: translateY(-1px);
        }

        .risk-btn.score-1.active {
            background: #34c759 !important;
        }

        .risk-btn.score-3.active {
            background: #ff9500 !important;
        }

        .risk-btn.score-5.active {
            background: #ff3b30 !important;
        }

        .framework-section h3 {
            color: #1d1d1f;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .framework-content {
            font-size: 14px;
            color: #424245;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .alternatives h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .alternatives ul {
            list-style: none;
        }

        .alternatives li {
            font-size: 13px;
            color: #424245;
            margin-bottom: 12px;
            padding-left: 15px;
            position: relative;
        }

        .alternatives li:before {
            content: "â€¢";
            color: #007aff;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .mitigations h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .mitigations ul {
            list-style: none;
        }

        .mitigations li {
            font-size: 13px;
            color: #424245;
            margin-bottom: 12px;
            padding-left: 15px;
            position: relative;
        }

        .mitigations li:before {
            content: "â€¢";
            color: #ff9500;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .decision-output {
            background: #f9f9fb;
            border: 2px solid #e5e5ea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: all 0.3s ease;
        }

        .decision-placeholder {
            color: #86868b;
            font-size: 14px;
            font-style: italic;
        }

        .decision-result {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.5;
        }

        .decision-proceed {
            background: #f0fff0;
            border-color: #34c759;
            color: #1d6f32;
        }

.decision-pilot {
    background: #fffef0;
    border-color: #ffd700;
    color: #8b7500;
}

        .decision-postpone {
            background: #fff0f0;
            border-color: #ff3b30;
            color: #d12b20;
        }

        .decision-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .decision-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .decision-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 12px;
        }

        .score-display {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .score-display h4 {
            color: #007aff;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .score-item {
            text-align: center;
            font-size: 12px;
        }

        .score-item .score-label {
            color: #424245;
            margin-bottom: 2px;
        }

        .score-item .score-value {
            font-weight: 600;
            color: #1d1d1f;
        }

        .total-score {
            text-align: center;
            padding-top: 10px;
            border-top: 1px solid #d2d2d7;
            margin-top: 10px;
        }

        .total-score .score-label {
            color: #424245;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .total-score .score-value {
            font-size: 18px;
            font-weight: 700;
            color: #007aff;
        }

        .decision-range-box {
            background: #f0f0f5;
            border: 2px solid #d2d2d7;
            border-radius: 8px;
            padding: 12px 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .decision-range-box .range-title {
            font-size: 11px;
            font-weight: 600;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .decision-range-box .range-content {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
            line-height: 1.5;
        }

        .decision-range-box .range-category {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 0 3px;
            font-weight: 700;
        }

        .decision-range-box .range-suitable {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .decision-range-box .range-cautious {
    background: #fffef0;
    color: #8b7500;
        }

        .decision-range-box .range-not-suitable {
            background: #ffebee;
            color: #c62828;
        }

        .awaiting-input {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .awaiting-input h4 {
            color: #007aff;
            font-size: 14px;
            font-weight: 600;
        }

        .awaiting-input p {
            color: #424245;
            font-size: 12px;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-primary {
            background: #1f7ce6;
            color: white;
        }

        .btn-primary:hover {
            background: #263781;
        }

        .btn-secondary {
            background: #f5f5f7;
            color: #424245;
            border: 1px solid #d2d2d7;
        }

        .btn-secondary:hover {
            background: #e5e5ea;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            color: #ff3b30;
            font-size: 12px;
            margin-top: 5px;
        }

.preset-section {
    background: #f0f8ff;
    border: 2px solid #b3d9ff;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
}

.preset-title {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 12px;
    color: #007aff;
}

        .preset-loading {
            background: #fff8f0;
            border: 1px solid #ff9500;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }

        .preset-loading h4 {
            color: #ff9500;
            font-size: 14px;
            font-weight: 600;
        }

@media (max-width: 768px) {
    .risk-factors {
        grid-template-columns: 1fr;
    }
    
    .score-breakdown {
        grid-template-columns: 1fr;
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    .risk-factors {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1025px) {
    .risk-factors {
        grid-template-columns: repeat(3, 1fr);
    }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Agentic AI Suitability - Solution</h1>
            <p>AI-powered assessment tool that provides intelligent recommendations based on your specific use case context and risk factors.</p>
        </div>

        

        <div class="main-content">
            <div class="left-panel">
                <div class="section">
                    <h3>Use Case Information</h3>

    <!-- Sample Use Cases Dropdown -->
    <div style="margin-bottom: 15px;">
        <label for="sampleUseCase" style="font-size: 13px; color: #86868b; font-weight: 400;">Select a sample use case:</label>
        <select id="sampleUseCase" onchange="loadSampleUseCase()" style="padding: 10px; font-size: 13px;">
            <option value="">-- Select a sample use case --</option>
            <option value="appointment">Hospital Appointment Booking Agent</option>
            <option value="fraud">Real-time Fraud Detection System</option>
            <option value="customer">Customer Support Chatbot</option>
            <option value="compliance">Regulatory Compliance Auditor</option>
        </select>
    </div>


                    <div class="form-group">
                        <label for="usecaseName">Use Case Name <span class="required">*</span></label>
                        <input type="text" id="usecaseName" placeholder="Enter your use case name">
                    </div>
                    <!-- <div class="form-group">
                        <label for="description">Use Case Description <span class="required">*</span></label>
                        <textarea id="description" placeholder="Detailed description of the use case, stakeholders involved, and expected outcomes" required></textarea>
                        <div id="descriptionError" class="error-message" style="display: none;">Description is required</div>
                    </div>
                </div> -->



    



    <div class="form-group">
    <label for="description">Use Case Description <span class="required">*</span></label>
    
    <!-- Tab-like selector to switch between text and file upload -->
    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <button type="button" id="textInputTab" class="input-method-tab active" onclick="switchInputMethod('text')">
            Type Description
        </button>
        <button type="button" id="fileUploadTab" class="input-method-tab" onclick="switchInputMethod('file')">
            Upload File
        </button>
    </div>
    
    <!-- Text Input -->
    <div id="textInputSection">
        <textarea id="description" placeholder="Detailed description of the use case, stakeholders involved, and expected outcomes" required></textarea>
    </div>
    
    <!-- File Upload -->
    <div id="fileUploadSection" style="display: none;">
        <div style="border: 2px dashed #d2d2d7; border-radius: 8px; padding: 20px; text-align: center; background: #fafafa; cursor: pointer; transition: all 0.3s;"
             id="dropZone"
             onclick="document.getElementById('fileInput').click()">
            <div style="font-size: 32px; margin-bottom: 10px;">ðŸ“„</div>
            <div style="font-size: 14px; color: #424245; margin-bottom: 5px;">
                <strong>Click to upload</strong> or drag and drop
            </div>
            <div style="font-size: 12px; color: #86868b;">
                Supports: TXT, PDF, DOCX (Max 5MB)
            </div>
            <input type="file" id="fileInput" accept=".txt,.pdf,.docx,.doc" style="display: none;" onchange="handleFileUpload(event)">
        </div>
        <div id="fileInfo" style="display: none; margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 6px; font-size: 13px;">
            <strong>Uploaded:</strong> <span id="fileName"></span>
            <button type="button" onclick="clearFile()" style="float: right; background: none; border: none; color: #ff3b30; cursor: pointer; font-size: 12px;">âœ• Remove</button>
        </div>
    </div>
    
    <div id="descriptionError" class="error-message" style="display: none;">Description is required</div>
</div>

                <div class="section">
                    <div class="form-group">
                        <label>Expected Autonomy Level</label>
                        <select id="autonomyLevel">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium â€” Human-on-the-loop</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <div class="form-group">
                        <label>Does this affect our customers or regulatory compliance?</label>
                        <select id="criticality">
                            <option value="yes" selected>Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                </div>

                <!-- Preset/Manual Risk Rating Section -->
                <div class="preset-section">
                    <div class="preset-title">Risk Assessment Method</div>
                    <div class="form-group">
                        <label>Choose Assessment Method</label>
                        <select id="assessmentMethod" onchange="handleAssessmentMethodChange()">
                            <option value="manual" selected>Manually select risk factors</option>
                            <option value="preset">Load role-specific preset</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="rolePresetGroup" style="display: none;">
                        <label>Select Role-Specific Preset</label>
                        <select id="rolePreset" onchange="handleRolePresetChange()">
                            <option value="">Select a role...</option>
                            <option value="finance">Finance (Regulatory/compliance-heavy)</option>
                            <option value="operations">Operations (Real-time control/process automation)</option>
                            <option value="security">Security (Access control/sensitive data)</option>
                            <option value="customer-service">Customer Service / Support (High human touch)</option>
                        </select>
                    </div>

                    <div id="presetLoading" class="preset-loading" style="display: none;">
                        <h4><span class="loading"></span>AI is analyzing your use case and applying role-specific risk ratings...</h4>
                    </div>
                </div>

                <!-- Business Value Category -->
                <div class="category-section business-value">
                    <div class="category-title">Business Value</div>
                    <div class="category-weight">Weight: 40% of total score</div>
                    <div class="risk-factors">
                        <div class="factor-group" data-factor="cost" data-category="business">
                            <div class="factor-title">Cost</div>
                            <div class="factor-subtitle">Operational costs (LLM API calls), system resource costs (IT infrastructure), and human resource costs (employee salaries and labor)</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'cost', 1)">Low (5)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'cost', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'cost', 5)">High (1)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="time-efficiency" data-category="business">
                            <div class="factor-title">Time Efficiency</div>
                            <div class="factor-subtitle">Cycle time reduction, throughput increase, and latency reduction for customer-facing tasks</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'time-efficiency', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'time-efficiency', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'time-efficiency', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="accuracy-quality" data-category="business">
                            <div class="factor-title">Accuracy & Quality</div>
                            <div class="factor-subtitle">Error rate reduction, compliance & audit success, and consistency in standardized task execution</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'accuracy-quality', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'accuracy-quality', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'accuracy-quality', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="productivity-scalability" data-category="business">
                            <div class="factor-title">Productivity & Scalability</div>
                            <div class="factor-subtitle">Employee productivity improvements, scalability for larger volumes, and automation coverage percentage</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'productivity-scalability', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'productivity-scalability', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'productivity-scalability', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="strategic-opportunity" data-category="business">
                            <div class="factor-title">Strategic/Opportunity Impact</div>
                            <div class="factor-subtitle">Innovation enablement for new business models, competitive advantage, and risk mitigation (financial, operational, compliance)</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'strategic-opportunity', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'strategic-opportunity', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'strategic-opportunity', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="transparency" data-category="business">
                            <div class="factor-title">Transparency</div>
                            <div class="factor-subtitle">Agentic AI's decisions may lack clear, traceable reasoning, posing compliance and trust risks in regulated or customer-facing contexts</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'transparency', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'transparency', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'transparency', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="human-impact" data-category="business">
                            <div class="factor-title">Human Impact</div>
                            <div class="factor-subtitle">AI cannot replicate empathy, and removing humans risks harming customer trust and brand reputation</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'human-impact', 1)">Low (5)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'human-impact', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'human-impact', 5)">High (1)</button>
                            </div>
                        </div>
                    </div>
                </div>  

                <!-- Technical Fit Category -->
                <div class="category-section technical-fit">
                    <div class="category-title">Technical Fit</div>
                    <div class="category-weight">Weight: 40% of total score</div>
                    <div class="risk-factors">
                        <div class="factor-group" data-factor="integration-complexity" data-category="technical">
                            <div class="factor-title">Integration Complexity</div>
                            <div class="factor-subtitle">Legacy-modern system complexity can lead to delays, higher costs, and unstable AI performance across platforms</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'integration-complexity', 1)">Low (5)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'integration-complexity', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'integration-complexity', 5)">High (1)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="real-time-data" data-category="technical">
                            <div class="factor-title">Real-time Data Requirements</div>
                            <div class="factor-subtitle">LLM agents' latency limits can risk safety and losses in high-speed, time-critical environments</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'real-time-data', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'real-time-data', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'real-time-data', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="autonomy-goal-orientation" data-category="technical">
                            <div class="factor-title">Autonomy & Goal-Orientation</div>
                            <div class="factor-subtitle">From rule-bound execution to guided decisions to fully autonomous, goal-driven multi-step planning</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'autonomy-goal-orientation', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'autonomy-goal-orientation', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'autonomy-goal-orientation', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="statefulness-memory" data-category="technical">
                            <div class="factor-title">Statefulness & Memory</div>
                            <div class="factor-subtitle">Tasks range from stateless to context-aware to requiring memory for long-term reasoning and continuity</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'statefulness-memory', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'statefulness-memory', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'statefulness-memory', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="human-in-loop" data-category="technical">
                            <div class="factor-title">Human-in-the-Loop Requirement</div>
                            <div class="factor-subtitle">Autonomy ranges from full human oversight to partial checkpoints to mostly unattended operation</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'human-in-loop', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'human-in-loop', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'human-in-loop', 5)">High (5)</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Safety and Governance Category -->
                <div class="category-section safety-governance">
                    <div class="category-title">Safety and Governance</div>
                    <div class="category-weight">Weight: 20% of total score</div>
                    <div class="risk-factors">
                        <div class="factor-group" data-factor="governance-requirements" data-category="governance">
                            <div class="factor-title">Governance Requirements</div>
                            <div class="factor-subtitle">Without proper oversight, AI agents can act against policies, laws, or ethics unnoticed until issues arise</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'governance-requirements', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'governance-requirements', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'governance-requirements', 5)">High (5)</button>
                            </div>
                        </div>

                        <div class="factor-group" data-factor="security-implications" data-category="governance">
                            <div class="factor-title">Security Implications</div>
                            <div class="factor-subtitle">Autonomous AI access to sensitive systems creates risks of exploitation and data breaches</div>
                            <div class="risk-buttons">
                                <button type="button" class="risk-btn score-1" onclick="selectRisk(this, 'security-implications', 1)">Low (1)</button>
                                <button type="button" class="risk-btn score-3" onclick="selectRisk(this, 'security-implications', 3)">Medium (3)</button>
                                <button type="button" class="risk-btn score-5" onclick="selectRisk(this, 'security-implications', 5)">High (5)</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="awaitingInput" class="awaiting-input">
                    <h4>Awaiting Input</h4>
                    <p>Complete all required fields and rate all factors to get evaluation.</p>
                </div>

                <div class="section">
                    <h3>AI Evaluation Results</h3>
                    <div id="decisionOutput" class="decision-output">
                        <div class="decision-placeholder">
                            Complete all factor ratings and click Submit to see the AI evaluation results
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="action-buttons">
                        <button id="submitBtn" class="btn btn-primary" onclick="submitAssessment()">Get AI Evaluation</button>
                        <button class="btn btn-secondary" onclick="resetForm()">Reset</button>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="framework-section">
                    <h3>AI-Powered Evaluation</h3>
                    <div class="framework-content">
                        This tool uses Google's Gemini 2.0 Flash to provide intelligent, expert-level assessments for autonomous AI agent implementation. The AI analyzes all factor interactions, use case context, and industry best practices to deliver:
                        <br><br>
                        <strong>Comprehensive Scoring:</strong><br>
                        The AI weighs factors based on your specific use case context rather than simple mathematical averages.
                        <br><br>
                        <strong>Expert Decision Making:</strong><br>
                        â€¢ Suitable: Low overall risk, good fit for agentic AI<br>
                        â€¢ Cautious: Moderate risk, suitable with safeguards<br>
                        â€¢ Not Suitable: High risk, recommend alternatives
                        <br><br>
                        <strong>Intelligent Analysis:</strong><br>
                        The AI considers factor interdependencies and provides tailored recommendations based on your specific scenario.
                    </div>

                    <div class="alternatives">
                        <h4>Alternatives</h4>
                        <ul>
                            <li>Use a rules-based automation system for routine tasks and only involve a human in complex tasks.</li>
                            <li>Use Agentic AI only as a support tool while a human leads the conversation.</li>
                            <li>Start with supervised automation before attempting multi-system autonomy.</li>
                            <li>Create human-led approval workflows for outbound communications and have governance frameworks are in place.</li>
                        </ul>
                    </div>

                    <div class="mitigations">
                        <h4>Mitigations</h4>
                        <ul>
                            <li>Implement cost-governance controls â€” limit API calls, use budget caps.</li>
                            <li>Set boundaries where Agentic AI escalates to a human for emotionally charged or sensitive topics.</li>
                            <li>For mission-critical systems â€” store reasoning steps.</li>
                            <li>Implement agent policy enforcement.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        
        // const GEMINI_API_KEY = 'AIzaSyD7zCT8ZAjh_ZdEkO48nzk-T6NDKLNbWcY';
        const GEMINI_API_KEY = 'AIzaSyAmT4KDfkmBunEB98q8dv5xS2mf8BJDt9g';

        // const GEMINI_API_KEY = 'AIzaSyCVKWx7m-IpEpeViPKgclViRdDxaSrq2LI';
        // const GEMINI_API_KEY = 'AIzaSyCIyX7r4GDH_-ovSY3G2LaUWVPrJ0vEKiA';
        
        const GEMINI_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent';

        // Store factor scores
        let factorScores = {};
        let lastAssessmentMethod = 'manual';
        let presetFactorScores = {};

        // Sample use cases
const sampleUseCases = {
    appointment: {
        name: "Hospital Appointment Booking Agent",
        description: `The scheduling AI agent must integrate real-time hospital network resources to optimize patient appointment booking, reduce no-shows, and streamline administrative.`
    },
    fraud: {
        name: "Real-time Fraud Detection System",
        description: `An autonomous AI agent for a financial institution that monitors and responds to suspicious transactions in real-time. The agent can:
- Analyze transaction patterns across millions of accounts simultaneously
- Flag suspicious activities based on behavioral anomalies
- Automatically block high-risk transactions above certain thresholds
- Send alerts to security teams for manual review
- Execute temporary account freezes to prevent fraud
- Generate detailed fraud reports for regulatory compliance
- Learn from feedback to improve detection accuracy

Stakeholders: Account holders, fraud analysts, compliance officers, regulators
Expected Outcomes: Detect fraud within seconds, reduce false positives by 60%, prevent $50M+ in annual fraud losses`
    },
    customer: {
        name: "Customer Support Chatbot",
        description: `An AI-powered customer service agent for an e-commerce platform that handles customer inquiries autonomously. The agent can:
- Answer product questions and provide recommendations
- Process returns, refunds, and exchanges
- Track order status and shipping information
- Resolve billing disputes and payment issues
- Escalate complex cases to human agents
- Access customer purchase history and preferences
- Provide personalized discount codes and promotions
- Handle multi-language conversations

Stakeholders: Customers, support agents, sales team, operations team
Expected Outcomes: Handle 80% of inquiries without human intervention, reduce response time to under 1 minute, improve customer satisfaction by 35%`
    },
    compliance: {
        name: "Regulatory Compliance Auditor",
        description: `An autonomous AI agent that monitors and audits business operations for regulatory compliance. The agent can:
- Review contracts, invoices, and financial documents for compliance violations
- Monitor employee communications for policy breaches
- Track regulatory changes and update internal policies
- Generate compliance reports for auditors and regulators
- Flag potential violations before they occur
- Recommend corrective actions and process improvements
- Maintain audit trails for all compliance activities
- Integrate with legal and HR systems

Stakeholders: Compliance officers, legal team, auditors, regulators, executives
Expected Outcomes: Reduce compliance violations by 85%, cut audit preparation time by 60%, avoid $10M+ in potential fines`
    }
};

function loadSampleUseCase() {
    const selected = document.getElementById('sampleUseCase').value;
    if (!selected) return;
    
    const useCase = sampleUseCases[selected];
    
    // Populate use case name
    document.getElementById('usecaseName').value = useCase.name;
    
    // Populate description
    document.getElementById('description').value = useCase.description;
    
    // Clear file upload if active
    clearFile();
    
    // Switch to text input mode
    switchInputMethod('text');
    
    // Update validation
    updateAwaitingInput();
    
    // Visual feedback
    // showNotification(`âœ“ Loaded sample use case: ${useCase.name}`, 'success');
}

        // Input method switching
function switchInputMethod(method) {
    const textTab = document.getElementById('textInputTab');
    const fileTab = document.getElementById('fileUploadTab');
    const textSection = document.getElementById('textInputSection');
    const fileSection = document.getElementById('fileUploadSection');
    
    if (method === 'text') {
        textTab.classList.add('active');
        fileTab.classList.remove('active');
        textSection.style.display = 'block';
        fileSection.style.display = 'none';
        
        // Clear file if switching back to text
        // clearFile();
    } else {
        textTab.classList.remove('active');
        fileTab.classList.add('active');
        textSection.style.display = 'none';
        fileSection.style.display = 'block';
    }
}

// File upload handler
async function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    // Add file type validation
    const allowedTypes = ['text/plain', 'application/pdf', 
                         'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
    
    if (!allowedTypes.includes(file.type)) 
    {
        alert('Invalid file type. Please upload TXT, PDF, or DOCX files.');
        clearFile();
        return;
    }

    // Validate file size (5MB max)
    if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        return;
    }
    
    const fileType = file.name.split('.').pop().toLowerCase();
    
    try {
        let text = '';
        
        if (fileType === 'txt') {
            text = await readTextFile(file);
        } else if (fileType === 'pdf') {
            text = await readPDFFile(file);
        } else if (fileType === 'docx' || fileType === 'doc') {
            text = await readDocxFile(file);
        } else {
            alert('Unsupported file type. Please upload TXT, PDF, or DOCX files.');
            return;
        }
        
        // Set the description
        document.getElementById('description').value = text;
        
        // Show file info
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileInfo').style.display = 'block';
        
        // Update validation
        updateAwaitingInput();
        
    } catch (error) {
        console.error('File reading error:', error);
        alert('Failed to read file. Please try again or use a different file.');
    }
}

// Read text file
function readTextFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = reject;
        reader.readAsText(file);
    });
}

// Read PDF file
async function readPDFFile(file) {
    try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let fullText = '';
        
        // Show progress for large PDFs
        const totalPages = pdf.numPages;
        for (let i = 1; i <= totalPages; i++) {
            // Update UI with progress
            updateFileProgress(i, totalPages);
            
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n';
        }
        
        return fullText;
    } catch (error) {
        throw new Error('Failed to read PDF file');
    }
}

// Read DOCX file
async function readDocxFile(file) {
    try {
        const arrayBuffer = await file.arrayBuffer();
        const result = await mammoth.extractRawText({ arrayBuffer });
        return result.value;
    } catch (error) {
        throw new Error('Failed to read DOCX file');
    }
}

// Clear file
function clearFile() {
    document.getElementById('fileInput').value = '';
    document.getElementById('fileInfo').style.display = 'none';
    document.getElementById('fileName').textContent = '';
}

// Drag and drop handlers
const dropZone = document.getElementById('dropZone');

dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragging');
});

dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragging');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragging');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        document.getElementById('fileInput').files = files;
        handleFileUpload({ target: { files: [files[0]] } });
    }
});

        // Factor context for AI understanding

const factorContext = {
    'cost': {
        description: 'Evaluates total operational expenditure â€” including LLM API usage, infrastructure runtime, and human effort for supervision or correction. Consider the frequency, duration, and complexity of agentic operations when estimating cost.',
        risk: 'Continuous or high-frequency autonomous reasoning loops can cause runaway API usage or infrastructure costs that exceed manual process expenses.',
        alternative: 'For repetitive workflows, use deterministic rules-based automation and only involve humans for complex or high-stakes decisions.',
        mitigation: 'Set usage budgets, enforce API call quotas, and introduce cost-based throttling mechanisms.',
        example: 'A customer-support agent keeps polling APIs for ticket updates every second, generating large monthly API bills.'
    },
    'time-efficiency': {
        description: 'Measures how much the AI reduces cycle time, improves throughput, or minimizes task latency. Key consideration: speed gains vs reliability trade-offs.',
        risk: 'Over-optimizing for speed can create system bottlenecks if the agent mismanages parallel tasks or fails in edge cases.',
        alternative: 'Use the AI as a co-pilot that suggests or drafts outputs quickly but lets a human finalize and approve them.',
        mitigation: 'Implement timeout and fallback protocols with automatic escalation to human operators when latency exceeds limits.',
        example: 'An onboarding bot automates customer verification but stalls when an uncommon document format appears, delaying completion.'
    },
    'accuracy-quality': {
        description: 'Assesses how consistently and correctly the AI performs tasks, maintains compliance, and meets quality benchmarks.',
        risk: 'LLM hallucinations or misinterpretations can lead to factual errors, audit failures, or regulatory non-compliance.',
        alternative: 'Deploy specialized narrow AI for critical accuracy tasks and insert human verification for outputs that affect compliance or finances.',
        mitigation: 'Adopt tiered review systems â€” AI handles low-value or repetitive tasks while humans verify high-risk results.',
        example: 'An invoice classifier incorrectly tags tax codes, leading to audit mismatches and manual correction overhead.'
    },
    'productivity-scalability': {
        description: 'Measures the AIâ€™s ability to scale task automation, improve employee productivity, and sustain performance under higher loads.',
        risk: 'Blindly scaling automation may reduce output quality and create rework, negating productivity gains.',
        alternative: 'Automate repetitive tasks first, keeping human supervision for quality assurance or customer interaction layers.',
        mitigation: 'Implement feedback loops to expand automation coverage gradually as reliability improves.',
        example: 'A helpdesk AI successfully handles password resets but fails at nuanced troubleshooting, overwhelming escalation teams.'
    },
    'strategic-opportunity': {
        description: 'Captures whether AI contributes to innovation, competitive advantage, or long-term strategic positioning.',
        risk: 'Delegating strategic decisions to autonomous systems can create misalignment with corporate goals or brand values.',
        alternative: 'Let AI surface insights and recommendations while humans handle strategic interpretation and approval.',
        mitigation: 'Require the AI to produce confidence scores, cite sources, and get human review for strategic decisions.',
        example: 'A marketing AI autonomously discounts premium products, improving short-term sales but damaging brand value.'
    },
    'transparency': {
        description: 'Evaluates how explainable, traceable, and auditable the AIâ€™s reasoning and outputs are â€” critical for compliance and trust.',
        risk: 'Opaque LLM reasoning makes it impossible to justify decisions to regulators or customers.',
        alternative: 'Favor structured decision models or rule-based scoring systems for regulated contexts.',
        mitigation: 'Store intermediate reasoning traces, enable human-readable explanations, and maintain decision logs.',
        example: 'A loan approval bot rejects applicants without rationale, violating transparency rules.'
    },
    'human-impact': {
        description: 'Assesses emotional, social, and role-based implications of AI replacing or assisting human workers. Focus on empathy and user trust.',
        risk: 'AI cannot replicate empathy or human nuance, leading to poor experiences in emotionally charged or sensitive interactions.',
        alternative: 'Use AI as an assistant while keeping humans in the lead for relationship or empathy-driven scenarios.',
        mitigation: 'Define escalation triggers for human intervention when emotional sensitivity or judgment is required.',
        example: 'A grief-support chatbot attempts to comfort bereaved users but ends up sounding robotic and insensitive.'
    },
    'integration-complexity': {
        description: 'Analyzes the difficulty of integrating the AI agent with existing systems â€” especially legacy platforms with weak APIs.',
        risk: 'Complex or fragile integrations increase delays, maintenance costs, and system instability.',
        alternative: 'Start with small-scale integrations or isolated modules before connecting multiple systems.',
        mitigation: 'Use modular APIs, adapters, or middleware layers that allow swapping components without full rework.',
        example: 'A logistics agent must pull data from 10 legacy systems, causing frequent sync failures and inconsistent tracking.'
    },
    'real-time-data': {
        description: 'Evaluates latency sensitivity and real-time processing needs. Determines whether AI response speed is suitable for the use case.',
        risk: 'LLM-based agents typically have high inference latency, unsuitable for millisecond-level control or mission-critical safety loops.',
        alternative: 'Use deterministic, low-latency control systems (e.g., PLCs) for real-time operations and apply LLMs for analysis or recommendations.',
        mitigation: 'Restrict AI use to offline optimization, reporting, or predictive modeling rather than direct real-time control.',
        example: 'An AI tries to control a robotic arm directly but fails due to 300ms response lag, causing production slowdowns.'
    },
    'autonomy-goal-orientation': {
        description: 'Measures how independently the AI can plan and act toward defined goals. Ensures goals are measurable and bounded to prevent misaligned behavior.',
        risk: 'Poorly scoped goals can cause technically correct but strategically harmful decisions.',
        alternative: 'Use rule-based systems for predictable tasks and reserve goal-driven autonomy for bounded, well-defined objectives.',
        mitigation: 'Define guardrail metrics, validate outputs continuously, and enable human overrides when deviation occurs.',
        example: 'A sales agent focuses solely on maximizing conversions and spams customers, damaging long-term reputation.'
    },
    'statefulness-memory': {
        description: 'Assesses whether the AI can maintain and recall context across sessions or interactions to ensure continuity and personalization.',
        risk: 'Stateless agents forget past context, causing fragmented experiences and repetitive user interactions.',
        alternative: 'Log contextual metadata manually or use structured systems for explicit state tracking.',
        mitigation: 'Integrate the agent with persistent memory (vector DB or key-value store) to retrieve relevant context for each task.',
        example: 'A support AI forgets prior conversations, forcing customers to repeat issues every time they reconnect.'
    },
    'human-in-loop': {
        description: 'Defines the degree of human oversight and intervention in AI decision-making. Ensures accountability for critical or external actions.',
        risk: 'Lack of human checkpoints allows autonomous agents to make unverified or non-compliant decisions.',
        alternative: 'Retain human approval steps for high-risk actions or external communications.',
        mitigation: 'Introduce checkpoint systems requiring human validation above certain confidence or risk thresholds.',
        example: 'An expense-approval agent sends reimbursements without human review, leading to policy violations.'
    },
    'governance-requirements': {
        description: 'Addresses regulatory compliance, internal policy enforcement, and oversight needed to ensure ethical and lawful operation.',
        risk: 'Without governance, AI can violate laws or ethical standards, leading to reputational and legal risks.',
        alternative: 'Adopt manual approval workflows until a clear governance and audit policy is established.',
        mitigation: 'Create policy-enforcement dashboards and automated rule-based approval gates with human sign-offs for edge cases.',
        example: 'A marketing agent sends unauthorized promotional emails, breaching data privacy regulations.'
    },
    'security-implications': {
        description: 'Examines data protection, access control, and security vulnerabilities arising from autonomous system behavior.',
        risk: 'Prompt injection or external manipulation may lead the agent to leak or misuse sensitive data.',
        alternative: 'Keep sensitive operations human-controlled or require multi-factor authentication for critical steps.',
        mitigation: 'Enforce strict role-based access, sandbox AI capabilities, and monitor for anomaly patterns in requests.',
        example: 'An autonomous report generator accidentally exposes internal credentials when copying configuration logs.'
    }
};



       async function callGeminiAPI(prompt, retries = 2) {
    for (let i = 0; i <= retries; i++) {
        try {
            const response = await fetch(`${GEMINI_URL}?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.3,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 1536,
                    }
                })
            });

            if (!response.ok) {
                if (response.status === 429) {
                    // Rate limit hit - wait longer before retry
                    if (i < retries) {
                        const waitTime = Math.pow(2, i) * 2000; // 2s, 4s, 8s
                        console.log(`Rate limit hit. Waiting ${waitTime/1000}s before retry ${i+1}/${retries}`);
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                        continue;
                    }
                }
                throw new Error(`API Error: ${response.status}`);
            }

            const data = await response.json();
            let text = data.candidates[0].content.parts[0].text;
            
            // Strip markdown code fences if present
            text = text.replace(/```json\s*/g, '').replace(/```\s*$/g, '').trim();
            
            return text;
            
        } catch (error) {
            if (i === retries) {
                console.error('Gemini API Error:', error);
                throw error;
            }
            // Wait before retry for other errors too
            await new Promise(resolve => setTimeout(resolve, 1000));
        }
    }
}


        function handleAssessmentMethodChange() {
            const method = document.getElementById('assessmentMethod').value;
            const rolePresetGroup = document.getElementById('rolePresetGroup');
            
            if (method === 'preset') {
                rolePresetGroup.style.display = 'block';
            } else {
                rolePresetGroup.style.display = 'none';
                document.getElementById('rolePreset').value = '';
                document.getElementById('presetLoading').style.display = 'none';
            }
        }

       async function handleRolePresetChange() {
    const rolePreset = document.getElementById('rolePreset').value;
    const useCaseName = document.getElementById('usecaseName').value;
    const description = document.getElementById('description').value;
    
    if (!rolePreset) return;
    
    if (!description.trim()) {
        alert('Please provide a use case description before applying role-specific presets.');
        document.getElementById('rolePreset').value = '';
        return;
    }

    const presetLoading = document.getElementById('presetLoading');
    presetLoading.style.display = 'block';

    try {
        const prompt = createPresetPrompt(rolePreset, useCaseName, description);
        const response = await callGeminiAPI(prompt);
        
        // More robust JSON parsing
        const jsonMatch = response.match(/\{[\s\S]*\}/);
        if (!jsonMatch) {
            console.error('No JSON found in response:', response);
            console.log('Full AI response:', response);
            throw new Error('AI did not return valid JSON format');
        }
        
        let presetScores;
        try {
            presetScores = JSON.parse(jsonMatch[0]);
        } catch (parseError) {
            console.error('JSON parsing failed:', parseError);
            console.log('JSON string that failed:', jsonMatch[0]);
            throw new Error('Invalid JSON format from AI');
        }
        
        // More lenient validation - accept partial responses
        const requiredFactors = [
            'cost', 'time-efficiency', 'accuracy-quality', 'productivity-scalability',
            'strategic-opportunity', 'transparency', 'human-impact',
            'integration-complexity', 'real-time-data', 'autonomy-goal-orientation',
            'statefulness-memory', 'human-in-loop',
            'governance-requirements', 'security-implications'
        ];
        
        const returnedFactors = Object.keys(presetScores);
        const missingFactors = requiredFactors.filter(factor => !presetScores.hasOwnProperty(factor));
        
        console.log('AI returned scores for:', returnedFactors);
        console.log('Missing factors:', missingFactors);
        
        // Accept if we got at least 70% of factors
        if (returnedFactors.length < Math.ceil(requiredFactors.length * 0.7)) {
            console.error('Too few factors returned:', returnedFactors.length, 'out of', requiredFactors.length);
            throw new Error(`AI returned too few factors (${returnedFactors.length}/${requiredFactors.length}). Please try again.`);
        }
        
        // Validate that returned scores are valid (1, 3, or 5)
        const invalidScores = Object.entries(presetScores).filter(([factor, score]) => 
            ![1, 3, 5].includes(score)
        );
        
        if (invalidScores.length > 0) {
            console.error('Invalid scores found:', invalidScores);
            throw new Error('AI returned invalid score values. Please try again.');
        }
        
        // Apply the scores we got
        applyPresetScores(presetScores);
        lastAssessmentMethod = 'preset';
        
        // Inform user about missing factors
        if (missingFactors.length > 0) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 15px;
                margin-top: 15px;
                font-size: 13px;
                color: #856404;
            `;
            notification.innerHTML = `
                <strong>Partial preset applied:</strong><br>
                AI provided ratings for ${returnedFactors.length} out of ${requiredFactors.length} factors.<br>
                Please manually rate: ${missingFactors.join(', ')}
            `;
            
            const presetSection = document.querySelector('.preset-section');
            presetSection.appendChild(notification);
            
            // Remove notification after 10 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 10000);
        }
        
    } catch (error) {
        console.error('Full preset error details:', error);
        
        if (error.message.includes('400')) {
            alert('API authentication error. Please check your API key configuration.');
        } else if (error.message.includes('429')) {
            alert('API rate limit reached. Please wait a moment and try again, or select factors manually.');
        } else if (error.message.includes('JSON')) {
            alert('AI response format error. Please try again or select factors manually.');
        } else {
            alert(`Failed to apply role-specific preset: ${error.message}\n\nPlease try again or select factors manually.`);
        }
    } finally {
        presetLoading.style.display = 'none';
    }



        }

        function createPresetPrompt(rolePreset, useCaseName, description) {
            const roleContext = {
                'finance': 'Finance teams deal with regulatory compliance, audit requirements, financial data sensitivity, and strict governance. They typically need high transparency, strong governance controls, but may accept higher costs for compliance.',
                'operations': 'Operations teams focus on real-time processes, system reliability, efficiency gains, and minimal downtime. They need fast response times, high automation coverage, but are sensitive to integration complexity.',
                'security': 'Security teams prioritize data protection, access controls, threat mitigation, and risk management. They require strong governance, low security risks, but are cautious about transparency and human oversight.',
                'customer-service': 'Customer service teams value human connection, empathy, customer satisfaction, and brand reputation. They benefit from efficiency gains but are very sensitive to human impact and transparency.'
            };

            const factorContextString = Object.entries(factorContext).map(([factor, context]) => 
                `${factor}: ${context.description} | Risk: ${context.risk}`
            ).join('\n');

            const autonomyLevel = document.getElementById("autonomyLevel").value;
            const criticality = document.getElementById("criticality").value;

            return `
You are an expert AI consultant specializing in role-specific risk assessment for autonomous AI implementation. 
You deeply understand how autonomy level, customer/regulatory sensitivity, and organizational role context influence AI adoption risk across various operational factors.

**Factor Context:**
${factorContextString}

**Role Context:** ${roleContext[rolePreset]}

**Use Case Information:**
- Name: ${useCaseName || 'Custom use case'}
- Description: ${description}
- Selected Role: ${rolePreset}
- Anticipated Autonomy Level: ${autonomyLevel} 
   â†’ Low = AI supports or guides humans with limited independent action.
   â†’ Medium = AI automates decisions within bounded workflows, with periodic human oversight.
   â†’ High = AI operates with broad autonomy and makes independent decisions with minimal oversight.
- Mission-Critical, Customer-Facing, or Regulatory-Sensitive: ${criticality} 
   â†’ Yes = The system impacts customers directly, handles regulated processes, or affects safety/compliance outcomes.
   â†’ No = The system operates internally or has limited external or compliance exposure.

**Assessment Task:**
Based on this roleâ€™s priorities and the specific use case, analyze each factor and provide *risk ratings* (1 = Low, 3 = Medium, 5 = High). 
Do not use 2 or 4. Consider:
- The roleâ€™s typical goals, risk tolerance, and accountability.
- How the selected autonomy level changes oversight, decision scope, and control risk.
- How customer/regulatory sensitivity amplifies or reduces the risk for each factor.
- The potential operational or ethical consequences of AI behavior in this roleâ€™s context.

Return your response as a JSON object with factor names as keys and risk scores (ONLY 1, 3, or 5) as values, like this:
{
  "cost": 3,
  "time-efficiency": 5,
  "accuracy-quality": 1,
  ...
}

Ensure your reasoning aligns with both the role priorities and the contextual factors (autonomy level and criticality) for this specific use case.
`.trim();
        }

function applyPresetScores(presetScores) {


    // Clear existing selections
    document.querySelectorAll('.risk-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Apply new scores AND store original preset values
    factorScores = {};
    presetFactorScores = {}; // Store original preset values
    for (const [factor, score] of Object.entries(presetScores)) {
        factorScores[factor] = score;
        presetFactorScores[factor] = score; // Save the preset value
        
        // Find and activate the corresponding button
        const factorGroup = document.querySelector(`[data-factor="${factor}"]`);
        if (factorGroup) {
            const button = factorGroup.querySelector(`.risk-btn.score-${score}`);
            if (button) {
                button.classList.add('active');
            }
        }
    }
    
    updateAwaitingInput();

    // Show visual feedback
    // const appliedCount = Object.keys(presetScores).length;
    showNotification(`âœ“ AI-suggested risk-factor ratings applied`, 'success');
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: ${type === 'success' ? '#34c759' : '#007aff'};
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        animation: slideIn 0.3s ease;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

function createAssessmentPrompt() {
    const useCaseName = document.getElementById('usecaseName').value || 'Custom use case';
    const description = document.getElementById('description').value;
    const autonomyLevel = document.getElementById('autonomyLevel').value;
    const criticality = document.getElementById('criticality').value;
    const assessmentMethod = document.getElementById('assessmentMethod').value;
    const isCritical = criticality === 'yes';

    // Calculate scores with proper handling of missing values
    const businessFactors = ['cost', 'time-efficiency', 'accuracy-quality', 'productivity-scalability', 'strategic-opportunity', 'transparency', 'human-impact'];
    const technicalFactors = ['integration-complexity', 'real-time-data', 'autonomy-goal-orientation', 'statefulness-memory', 'human-in-loop'];
    const safetyFactors = ['governance-requirements', 'security-implications'];

    const businessSum = businessFactors.reduce((sum, factor) => {
        let score = factorScores[factor];
        if (score === undefined) return sum;
        
        if (factor === 'cost' || factor === 'human-impact' ) {
            score = 6 - score;
        }
        return sum + score;
    }, 0);

    const technicalSum = technicalFactors.reduce((sum, factor) => {
        let score = factorScores[factor];
        if (score === undefined) return sum;
        
        // Reverse scoring for integration-complexity (lower is better)
        if (factor === 'integration-complexity') {
            score = 6 - score;
        }
        return sum + score;
    }, 0);

    const safetySum = safetyFactors.reduce((sum, factor) => {
        const score = factorScores[factor];
        return score !== undefined ? sum + score : sum;
    }, 0);

    const ratedBusinessFactors = businessFactors.filter(factor => factorScores[factor] !== undefined);
    const ratedTechnicalFactors = technicalFactors.filter(factor => factorScores[factor] !== undefined);
    const ratedSafetyFactors = safetyFactors.filter(factor => factorScores[factor] !== undefined);

    const businessScore = ratedBusinessFactors.length > 0 ? 
        Math.round((businessSum / (ratedBusinessFactors.length * 5)) * 100) : 0;
    const technicalScore = ratedTechnicalFactors.length > 0 ? 
        Math.round((technicalSum / (ratedTechnicalFactors.length * 5)) * 100) : 0;
    const safetyScore = ratedSafetyFactors.length > 0 ? 
        Math.round((safetySum / (ratedSafetyFactors.length * 5)) * 100) : 0;
    
    const totalScore = Math.round((businessScore * 0.4) + (technicalScore * 0.4) + (safetyScore * 0.2));

    let decision, title, subtitle;
    if (totalScore >= 75) {
        decision = 'suitable';
        title = 'Suitable for Autonomous AI';
        subtitle = 'Proceed to pilot, fast track if pilot succeeds';
    } else if (totalScore >= 50) {
        decision = 'cautious';
        title = 'Cautious Approach Recommended';
        subtitle = 'Pilot with constraints and safety measures';
    } else {
        decision = 'not_suitable';
        title = 'Not Suitable for Full Autonomy';
        subtitle = 'Postpone or reframe - start with assisted, not autonomous';
    }

    // Different prompts based on assessment method
    if (assessmentMethod === 'manual') {
        // Manual selection - only key recommendations
        return `
You are an expert AI consultant. The user has manually selected risk ratings for their use case.

**Use Case**: ${useCaseName}
**Description**: ${description}
**Autonomy Level**: ${autonomyLevel}
**Critical/Customer-Facing/Regulatory**: ${criticality}

**Calculated Scores**:
- Business Value: ${businessScore}/100
- Technical Fit: ${technicalScore}/100
- Safety & Governance: ${safetyScore}/100
- Total Score: ${totalScore}/100

**Decision**: ${decision.toUpperCase()}

Provide 4-5 actionable key recommendations based on the scores and decision category. Keep recommendations specific and practical.

Return JSON format:
{
  "decision": "${decision}",
  "businessScore": ${businessScore},
  "technicalScore": ${technicalScore},
  "safetyScore": ${safetyScore},
  "totalScore": ${totalScore},
  "title": "${title}",
  "subtitle": "${subtitle}",
  "reasoning": "",
  "keyRecommendations": ["recommendation 1", "recommendation 2", "recommendation 3"]
}
        `.trim();
    } else {
        // Preset selection - detailed explanation
        
        // Only include factors that HAVEN'T been manually changed
        const unchangedFactors = Object.keys(presetFactorScores).filter(
            factor => factorScores[factor] === presetFactorScores[factor]
        );
        
        // Build the factor ratings string only for unchanged factors
        let factorRatingsText = '';
        
        const unchangedBusiness = businessFactors.filter(f => unchangedFactors.includes(f));
        const unchangedTechnical = technicalFactors.filter(f => unchangedFactors.includes(f));
        const unchangedSafety = safetyFactors.filter(f => unchangedFactors.includes(f));
        
if (unchangedBusiness.length > 0) {
            factorRatingsText += 'Business Value (AI-suggested, unchanged by user):\n';
            unchangedBusiness.forEach(factor => {
                const score = factorScores[factor];
                let level, explanation;
                
                // Reverse interpretation for cost and human-impact
                if (factor === 'cost' || factor === 'human-impact') {
                    level = score === 1 ? 'High' : score === 3 ? 'Medium' : 'Low';
                    explanation = score === 1 ? 'High cost/impact concern' : score === 3 ? 'Medium cost/impact' : 'Low cost/impact (beneficial)';
                } else {
                    level = score === 1 ? 'Low' : score === 3 ? 'Medium' : 'High';
                    explanation = '';
                }
                
                const factorName = factor.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                factorRatingsText += `- ${factorName}: ${score} (${level}${explanation ? ' - ' + explanation : ''})\n`;
            });
        }
        
if (unchangedTechnical.length > 0) {
    factorRatingsText += '\nTechnical (AI-suggested, unchanged by user):\n';
    unchangedTechnical.forEach(factor => {
        const score = factorScores[factor];
        let level, explanation;
        
        // Reverse interpretation for integration-complexity
        if (factor === 'integration-complexity') {
            level = score === 1 ? 'High' : score === 3 ? 'Medium' : 'Low';
            explanation = score === 1 ? 'High complexity concern' : score === 3 ? 'Medium complexity' : 'Low complexity (beneficial)';
        } else {
            level = score === 1 ? 'Low' : score === 3 ? 'Medium' : 'High';
            explanation = '';
        }
        
        const factorName = factor.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        factorRatingsText += `- ${factorName}: ${score} (${level}${explanation ? ' - ' + explanation : ''})\n`;
    });
}
        
        if (unchangedSafety.length > 0) {
            factorRatingsText += '\nSafety (AI-suggested, unchanged by user):\n';
            unchangedSafety.forEach(factor => {
                const score = factorScores[factor];
                const level = score === 1 ? 'Low' : score === 3 ? 'Medium' : 'High';
                const factorName = factor.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                factorRatingsText += `- ${factorName}: ${score} (${level})\n`;
            });
        }
        
        return `


You are an expert AI consultant. You previously provided AI-suggested risk ratings via role-specific preset. Now explain WHY you selected those ratings.

**IMPORTANT**: Only explain the factors that YOU originally suggested and that the USER HAS NOT CHANGED. Do not explain factors the user manually modified.

**Use Case**: ${useCaseName}
**Description**: ${description}
**Autonomy Level**: ${autonomyLevel}
**Critical/Customer-Facing/Regulatory**: ${criticality}

**Your AI-Suggested Factor Ratings (UNCHANGED by user):**
${factorRatingsText}

**Calculated Scores**:
- Business: ${businessScore}/100, Technical: ${technicalScore}/100, Safety: ${safetyScore}/100
- Total Score: ${totalScore}/100

**Your Task**: 
1. Explain in bullet points WHY you (the AI) selected the rating levels shown above (ONLY for unchanged factors)
2. Provide a comprehensive summary explaining the overall decision

**IMPORTANT FORMATTING RULES:**
- Use bullet points (â€¢) for each explanation
- DO NOT use markdown bold (**) or any other markdown formatting
- Write factor names in plain text followed by their score and level
- Keep explanations clear and concise
- Format: "â€¢ Factor Name (score, level): explanation text"

**Summary Requirements:**
Write a paragraph (3-5 sentences) that:
- References specific factor scores that influenced your decision (e.g., "The high score of 5 in accuracy-quality indicates...")
- Explains how the use case description content specifically impacts the assessment
- Discusses factor interactions (e.g., how high governance needs combined with low transparency creates risk)
- Connects your reasoning to the autonomy level (${autonomyLevel}) and criticality (${isCritical ? 'Yes' : 'No'})
- Justifies why ${totalScore} falls into the ${decision} category rather than the alternatives

Return JSON format:
{
  "decision": "${decision}",
  "businessScore": ${businessScore},
  "technicalScore": ${technicalScore},
  "safetyScore": ${safetyScore},
  "totalScore": ${totalScore},
  "title": "${title}",
  "subtitle": "${subtitle}",
  "reasoning": "â€¢ Bullet point explaining unchanged factor 1\nâ€¢ Bullet point explaining unchanged factor 2\nâ€¢ Bullet point explaining unchanged factor 3",
  "summary": "Comprehensive paragraph explaining the overall decision and why this score falls into this category. For example: (1) Reference AT LEAST 3-4 specific factors by name and their scores (e.g., 'The Medium rating (3) for Accuracy & Quality combined with High (5) for Governance Requirements indicates...'). (2) Explain how these SPECIFIC factor combinations create the total score of ${totalScore}. (3) Discuss why certain factors matter MORE for this hospital appointment booking use case. (4) Explain the trade-offs between high-scoring and low-scoring factors. (5) Justify why ${totalScore} is ${decision} and not in adjacent categories. YOUR REASONING MUST CITE ACTUAL FACTOR NAMES AND THEIR NUMERIC SCORES.",
  "keyRecommendations": ["recommendation 1", "recommendation 2", "recommendation 3"]
}
        `.trim();


            }
}



        function selectRisk(button, factor, score) {

        if (![1, 3, 5].includes(score)) {
                console.error('Invalid score:', score);
                return;
        }
    
            // Remove active class from all buttons in this category
            const categoryButtons = button.parentElement.querySelectorAll('.risk-btn');
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            
            // Add active class to clicked button
            button.classList.add('active');
            
            // Store the score
            factorScores[factor] = score;
            
            // Update awaiting input status
            updateAwaitingInput();
        }
        // Calculate scores with reverse scoring for cost and human-impact

        function updateAwaitingInput() {
            const requiredFactors = [
                'cost', 'time-efficiency', 'accuracy-quality', 'productivity-scalability',
                'strategic-opportunity', 'transparency', 'human-impact',
                'integration-complexity', 'real-time-data', 'autonomy-goal-orientation',
                'statefulness-memory', 'human-in-loop',
                'governance-requirements', 'security-implications'
            ];

            const description = document.getElementById('description').value.trim();
            const unratedFactors = requiredFactors.filter(factor => !factorScores.hasOwnProperty(factor));
            const awaitingDiv = document.getElementById('awaitingInput');
            
            if (!description) {
                awaitingDiv.innerHTML = `
                    <h4>Missing Information</h4>
                    <p>Description is required. Please fill in all required fields.</p>
                `;
                awaitingDiv.style.background = '#fff0f0';
                awaitingDiv.style.borderColor = '#ff3b30';
                return;
            }

            if (unratedFactors.length === 0) {
                awaitingDiv.innerHTML = `
                    <h4 style="color: #34c759;">Ready for AI Evaluation</h4>
                    <p>All factors rated. Click "Get AI Evaluation" for expert analysis.</p>
                `;
                awaitingDiv.style.background = '#f0fff0';
                awaitingDiv.style.borderColor = '#34c759';
            } else {
                awaitingDiv.innerHTML = `
                    <h4>Awaiting Input</h4>
                    <p>${unratedFactors.length} factor${unratedFactors.length > 1 ? 's' : ''} remaining to rate.</p>
                `;
                awaitingDiv.style.background = '#f0f8ff';
                awaitingDiv.style.borderColor = '#b3d9ff';
            }
        }

        async function submitAssessment() {
            const description = document.getElementById('description').value.trim();
            const descriptionError = document.getElementById('descriptionError');
            
            // Validate description
            if (!description) {
                descriptionError.style.display = 'block';
                document.getElementById('description').focus();
                return;
            } else {
                descriptionError.style.display = 'none';
            }

            // Check if all factors are rated
            const requiredFactors = [
                'cost', 'time-efficiency', 'accuracy-quality', 'productivity-scalability',
                'strategic-opportunity', 'transparency', 'human-impact',
                'integration-complexity', 'real-time-data', 'autonomy-goal-orientation',
                'statefulness-memory', 'human-in-loop',
                'governance-requirements', 'security-implications'
            ];

            const unratedFactors = requiredFactors.filter(factor => !factorScores.hasOwnProperty(factor));
            if (unratedFactors.length > 0) {
                alert(`Please rate all factors before submitting. ${unratedFactors.length} factor${unratedFactors.length > 1 ? 's' : ''} still need${unratedFactors.length === 1 ? 's' : ''} to be rated.`);
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span>AI is analyzing...';

            try {
    const assessmentMethod = document.getElementById('assessmentMethod').value;
    const prompt = createAssessmentPrompt();
    const response = await callGeminiAPI(prompt);
    
    console.log('Raw AI response:', response);
    
    // Parse the JSON response
    const jsonMatch = response.match(/\{[\s\S]*\}/);
    if (!jsonMatch) {
        throw new Error('Invalid response format from AI');
    }
    
    let jsonString = jsonMatch[0];
    let assessment;
    
    // Try multiple parsing strategies
    const parseStrategies = [
        // Strategy 1: Direct parse
        () => JSON.parse(jsonString),
        
        // Strategy 2: Clean control characters
        () => {
            const cleaned = jsonString.replace(/[\x00-\x09\x0B-\x0C\x0E-\x1F\x7F]/g, '');
            return JSON.parse(cleaned);
        },
        
        // Strategy 3: Fix common issues
        () => {
            let fixed = jsonString
                .replace(/[\x00-\x09\x0B-\x0C\x0E-\x1F\x7F]/g, '')
                .replace(/\n/g, '\\n')
                .replace(/\r/g, '\\r')
                .replace(/\t/g, '\\t')
                .replace(/\\\\n/g, '\\n'); // Fix double escaping
            return JSON.parse(fixed);
        },

        // Strategy 4: Extract and rebuild
() => {
    const decisionMatch = jsonString.match(/"decision":\s*"([^"]+)"/);
    const businessMatch = jsonString.match(/"businessScore":\s*(\d+)/);
    const technicalMatch = jsonString.match(/"technicalScore":\s*(\d+)/);
    const safetyMatch = jsonString.match(/"safetyScore":\s*(\d+)/);
    const totalMatch = jsonString.match(/"totalScore":\s*(\d+)/);
    const titleMatch = jsonString.match(/"title":\s*"([^"]+)"/);
    const subtitleMatch = jsonString.match(/"subtitle":\s*"([^"]+)"/);
    
    // Extract reasoning - try to find it before "summary" or "keyRecommendations"
    let reasoningText = '';
    const reasoning1 = jsonString.match(/"reasoning":\s*"([\s\S]*?)"\s*,\s*"summary"/);
    const reasoning2 = jsonString.match(/"reasoning":\s*"([\s\S]*?)"\s*,\s*"keyRecommendations"/);
    
    if (reasoning1) {
        reasoningText = reasoning1[1];
    } else if (reasoning2) {
        reasoningText = reasoning2[1];
    }
    
    // Extract summary - always try to find it
    let summaryText = '';
    const summary1 = jsonString.match(/"summary":\s*"([\s\S]*?)"\s*,\s*"keyRecommendations"/);
    const summary2 = jsonString.match(/"summary":\s*"([\s\S]*?)"\s*\}/);
    
    if (summary1) {
        summaryText = summary1[1];
    } else if (summary2) {
        summaryText = summary2[1];
    }
    
    const recsMatch = jsonString.match(/"keyRecommendations":\s*\[([\s\S]*?)\]\s*\}/);
    
    if (!decisionMatch || !totalMatch) {
        throw new Error('Could not extract required fields');
    }
    
    let recommendations = [];
    if (recsMatch) {
        const recsString = recsMatch[1];
        recommendations = recsString.match(/"([^"]+)"/g)?.map(s => s.slice(1, -1)) || [];
    }
    
    return {
        decision: decisionMatch[1],
        businessScore: parseInt(businessMatch?.[1] || '0'),
        technicalScore: parseInt(technicalMatch?.[1] || '0'),
        safetyScore: parseInt(safetyMatch?.[1] || '0'),
        totalScore: parseInt(totalMatch[1]),
        title: titleMatch?.[1] || 'Assessment Complete',
        subtitle: subtitleMatch?.[1] || '',
        reasoning: reasoningText.replace(/\\n/g, '\n').replace(/\\"/g, '"'),
        summary: summaryText.replace(/\\n/g, '\n').replace(/\\"/g, '"'),
        keyRecommendations: recommendations
    };
}
        
        // // Strategy 4: Extract and rebuild
        // () => {
        //     const decisionMatch = jsonString.match(/"decision":\s*"([^"]+)"/);
        //     const businessMatch = jsonString.match(/"businessScore":\s*(\d+)/);
        //     const technicalMatch = jsonString.match(/"technicalScore":\s*(\d+)/);
        //     const safetyMatch = jsonString.match(/"safetyScore":\s*(\d+)/);
        //     const totalMatch = jsonString.match(/"totalScore":\s*(\d+)/);
        //     const titleMatch = jsonString.match(/"title":\s*"([^"]+)"/);
        //     const subtitleMatch = jsonString.match(/"subtitle":\s*"([^"]+)"/);
        //     const reasoningMatch = jsonString.match(/"reasoning":\s*"([\s\S]*?)"\s*,\s*"keyRecommendations"/);
        //     const recsMatch = jsonString.match(/"keyRecommendations":\s*\[([\s\S]*?)\]\s*\}/);
            
        //     if (!decisionMatch || !totalMatch) {
        //         throw new Error('Could not extract required fields');
        //     }
            
        //     let recommendations = [];
        //     if (recsMatch) {
        //         const recsString = recsMatch[1];
        //         recommendations = recsString.match(/"([^"]+)"/g)?.map(s => s.slice(1, -1)) || [];
        //     }
            
        //     return {
        //         decision: decisionMatch[1],
        //         businessScore: parseInt(businessMatch?.[1] || '0'),
        //         technicalScore: parseInt(technicalMatch?.[1] || '0'),
        //         safetyScore: parseInt(safetyMatch?.[1] || '0'),
        //         totalScore: parseInt(totalMatch[1]),
        //         title: titleMatch?.[1] || 'Assessment Complete',
        //         subtitle: subtitleMatch?.[1] || '',
        //         reasoning: reasoningMatch?.[1]?.replace(/\\n/g, '\n') || '',
        //         keyRecommendations: recommendations
        //     };
        // }
    ];
    
    // Try each strategy until one works
    let lastError;
    for (let i = 0; i < parseStrategies.length; i++) {
        try {
            console.log(`Trying parse strategy ${i + 1}...`);
            assessment = parseStrategies[i]();
            console.log('Parse successful with strategy', i + 1);
            break;
        } catch (e) {
            console.log(`Strategy ${i + 1} failed:`, e.message);
            lastError = e;
            if (i === parseStrategies.length - 1) {
                throw new Error(`All parsing strategies failed. Last error: ${e.message}`);
            }
        }
    }
    
    if (assessment) {
        updateDecisionDisplay(assessment);
    } else {
        throw new Error('Failed to parse assessment');
    }

            // try {
            //     const assessmentMethod = document.getElementById('assessmentMethod').value;
            //     const prompt = createAssessmentPrompt();
            //     const response = await callGeminiAPI(prompt);
                
            //     // Parse the JSON response
            //     const jsonMatch = response.match(/\{[\s\S]*\}/);
            //     if (!jsonMatch) {
            //         throw new Error('Invalid response format from AI');
            //     }
                
            //     const assessment = JSON.parse(jsonMatch[0]);
            //     updateDecisionDisplay(assessment);
                
            } 
            // catch (error) {
            //     console.error('Assessment error:', error);
            //     const outputDiv = document.getElementById('decisionOutput');
            //     outputDiv.innerHTML = `
            //         <div class="decision-placeholder">
            //             <span style="color: #ff3b30;">âš ï¸ AI Assessment Error</span><br>
            //             Failed to get AI assessment. Please check your connection and try again.
            //         </div>
            //     `;
            catch (error) {
        console.error('Assessment error:', error);
        
        // More specific error messages
        let errorMessage = 'Failed to get AI assessment. ';
        if (error.message.includes('429')) {
            errorMessage += 'Rate limit reached. Please wait a moment.';
        } else if (error.message.includes('API')) {
            errorMessage += 'API connection issue. Please try again.';
        } else {
            errorMessage += 'Please check your connection and try again.';
        }
        
        // Show user-friendly error
        outputDiv.innerHTML = `
            <div class="decision-placeholder">
                <span style="color: #ff3b30;">âš ï¸ ${errorMessage}</span>
            </div>
        `;
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }



function updateDecisionDisplay(assessment) {
    const outputDiv = document.getElementById('decisionOutput');
    
    // Log to debug
    console.log('Parsed assessment object:', assessment);
    console.log('Summary field:', assessment.summary);
    
    const decisionConfig = {
        suitable: {
            icon: 'âœ…',
            class: 'decision-proceed',
            borderColor: '#34c759'
        },
        cautious: {
            icon: 'âš ï¸',
            class: 'decision-pilot',
            borderColor: '#ffd700'
        },
        not_suitable: {
            icon: 'âŒ',
            class: 'decision-postpone',
            borderColor: '#ff3b30'
        }
    };

    const config = decisionConfig[assessment.decision] || decisionConfig.cautious;

    // Color-code factor ratings function - MUST BE DEFINED FIRST
    function colorCodeFactorRatings(text) {
        if (!text) return text;
        
        // Replace (5, High) or (High) with red color
        text = text.replace(/\(5,?\s*High\)/gi, '<span style="color: #ff3b30; font-weight: 600;">(5, High)</span>');
        text = text.replace(/\(High\)/gi, '<span style="color: #ff3b30; font-weight: 600;">(High)</span>');
        
        // Replace (3, Medium) or (Medium) with orange color
        text = text.replace(/\(3,?\s*Medium\)/gi, '<span style="color: #ff9500; font-weight: 600;">(3, Medium)</span>');
        text = text.replace(/\(Medium\)/gi, '<span style="color: #ff9500; font-weight: 600;">(Medium)</span>');
        
        // Replace (1, Low) or (Low) with green color
        text = text.replace(/\(1,?\s*Low\)/gi, '<span style="color: #34c759; font-weight: 600;">(1, Low)</span>');
        text = text.replace(/\(Low\)/gi, '<span style="color: #34c759; font-weight: 600;">(Low)</span>');
        
        return text;
    }

    // Decision Range Box - appears for both manual and preset
    const decisionRangeHtml = `
        <div class="decision-range-box">
            <div class="range-title">Decision Framework</div>
            <div class="range-content">
                <span class="range-category ${assessment.decision === 'suitable' ? 'range-suitable' : ''}">â‰¥75: Suitable</span>
                <span class="range-category ${assessment.decision === 'cautious' ? 'range-cautious' : ''}">50-74: Cautious</span>
                <span class="range-category ${assessment.decision === 'not_suitable' ? 'range-not-suitable' : ''}">&lt;50: Not Suitable</span>
            </div>
        </div>
    `;

    // Only show reasoning if it exists (preset mode) - WITH COLOR CODING
    const reasoningHtml = assessment.reasoning && assessment.reasoning.trim() ? 
        `<div style="font-size: 13px; line-height: 1.6; text-align: left; margin-top: 15px;">
            <strong>Expert Analysis:</strong><br>
            <div style="white-space: pre-line; margin-top: 8px;">${colorCodeFactorRatings(assessment.reasoning)}</div>
        </div>` : '';

    // Add summary section - ALWAYS SHOW IF IT EXISTS
    const summaryHtml = assessment.summary && assessment.summary.trim() ? 
        `<div style="font-size: 13px; line-height: 1.7; text-align: left; margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #f9f9fb 0%, #ffffff 100%); border-left: 4px solid ${config.borderColor}; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <strong style="font-size: 15px; color: #1d1d1f;">Summary</strong>
            </div>
            <div style="color: #424245; font-size: 13px; line-height: 1.7;">${assessment.summary}</div>
        </div>` : '';

    const recommendationsHtml = assessment.keyRecommendations && assessment.keyRecommendations.length > 0 ? 
        `<div style="margin-top: 15px; font-size: 12px; text-align: left;">
            <strong>Key Recommendations:</strong>
            <ul style="margin: 5px 0 0 20px; list-style: disc;">
                ${assessment.keyRecommendations.map(rec => `<li style="margin-bottom: 5px;">${rec}</li>`).join('')}
            </ul>
         </div>` : '';

    outputDiv.innerHTML = `
        <div class="decision-result">
            <span class="decision-icon">${config.icon}</span>
            <div class="decision-title">${assessment.title}</div>
            <div class="decision-subtitle">${assessment.subtitle}</div>
            <div class="score-display">
                <div class="score-breakdown">
                    <div class="score-item">
                        <div class="score-label">Business Value</div>
                        <div class="score-value">${assessment.businessScore}/100</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">Technical Fit</div>
                        <div class="score-value">${assessment.technicalScore}/100</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">Safety & Governance</div>
                        <div class="score-value">${assessment.safetyScore}/100</div>
                    </div>
                </div>
                <div class="total-score">
                    <div class="score-label">Total Score</div>
                    <div class="score-value">${assessment.totalScore}/100</div>
                </div>
            </div>
            ${decisionRangeHtml}
            ${reasoningHtml}
            ${summaryHtml}
            ${recommendationsHtml}
        </div>
    `;
    
    outputDiv.className = `decision-output ${config.class}`;
}

        function resetForm() {
            // Reset form fields
            document.getElementById('usecaseName').value = '';
            document.getElementById('description').value = '';
            document.getElementById('autonomyLevel').value = 'medium';
            document.getElementById('criticality').value = 'yes';
            document.getElementById('assessmentMethod').value = 'manual';
            document.getElementById('rolePreset').value = '';
            
            // Hide role preset group and loading
            document.getElementById('rolePresetGroup').style.display = 'none';
            document.getElementById('presetLoading').style.display = 'none';
            
            // Reset all risk buttons
            document.querySelectorAll('.risk-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Clear factor scores
            factorScores = {};
            lastAssessmentMethod = 'manual';
            
            
            // Hide error messages
            document.getElementById('descriptionError').style.display = 'none';
            
            // Reset decision output
            const outputDiv = document.getElementById('decisionOutput');
            outputDiv.innerHTML = '<div class="decision-placeholder">Complete all factor ratings and click Submit to see the AI evaluation results</div>';
            outputDiv.className = 'decision-output';
            
            // Reset awaiting input
            updateAwaitingInput();
        }

        // Add validation for description field
        document.getElementById('description').addEventListener('blur', function() {
            const descriptionError = document.getElementById('descriptionError');
            if (!this.value.trim()) {
                descriptionError.style.display = 'block';
            } else {
                descriptionError.style.display = 'none';
            }
            updateAwaitingInput();
        });

        document.getElementById('description').addEventListener('input', function() {
            updateAwaitingInput();
        });

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            updateAwaitingInput();
        });
    </script>

    <a href="http://localhost:5501/Framework.html" 
       target="_blank"
       style="position: fixed; bottom: 20px; right: 20px; padding: 12px 20px; background: #007aff; color: white; text-decoration: none; border-radius: 25px; font-size: 13px; font-weight: 600; box-shadow: 0 4px 12px rgba(0,122,255,0.3); z-index: 1000; transition: all 0.3s ease;"
       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(0,122,255,0.4)';"
       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,122,255,0.3)';">
       ðŸ“š Framework Guide
    </a>
</body>
</html>
